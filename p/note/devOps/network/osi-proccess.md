# 3.网络OSI

## 一．通信模型流程

## 1.OSI参考模型

![OSI模型](img/osi.png)

**linux命令模拟应用层连接:**

cd /proc/$$/fd

exec 8<> /dev/tcp/www.baidu.com/80		//建立连接

echo -e 'GET/HTTP/1.0\n'							 //传送数据（http：规范标准）

cat <& 8														　//最终演示的是一个应用层协议

## 2.tcp/ip五层模型

![](img/tcp-process.png)



**三次握手**

​		 1.A->B(A向B发送连接请求)

​		 2.A<-B(B应答A发送一个ok请求)

​		3.A->B(A向B发送确认连接请求并建立连接)

**四次分手**

​		1.A->B(A向B发送断开连接请求)

　　2.A<-B(B应答A发送一个ok请求)

​	    3.B->A(B向A发送断开连接请求)

​        4.B<-A(B收到Ａ应答,并断开链接．需要双方知晓并回应才可以断开链接)

**三次握手>数据传输>四次分手，成为一个最小粒度，不可被分割**

##  3.下一调机制

![](img/next-tiao.png)

**交换机(学习ip@mac绑定,二层的,没有网络层)**连接同一个局域网计算机，**路由器(比交换机多一个网络层)**连接不同网络的计算机



**传输控制层(查看本机现在与外围通信信息)：**

netstat -natp			//查看本机ip:port与外围　ip:prot　通信列表

​		一台计算机最多可以有65535个端口哦,握手确定连接后,两边都会随机产生一个发送端口

**网络层：**

route -n 					//查看ip路由表

```
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.1.1     0.0.0.0         UG    100    0        0 enp3s0
169.254.0.0     0.0.0.0         255.255.0.0     U     1000   0        0 enp3s0
192.168.1.0     0.0.0.0         255.255.255.0   U     100    0        0 enp3s0

$ ping baidu.com
PING baidu.com (39.156.69.79) 56(84) bytes of data.
首先会拿着目标ip(39.156.69.79)到路由表,和Genmask掩码做按位与运算,看能否和Destination匹配,如果匹配就得到了下一跳.
一般最终会找到网关,和Genmask(0.0.0.0)进行与运算得到Destination(0.0.0.0),最后Gateway(192.168.1.1)就找到网关(找到下一跳)
```

**链路层：**

​			DNS会解析域名与ip	,	ARP会解析ip与具体网卡

​			arp -an						//mac地址

**arp流程**:

​          刚启动计算机，arp表是空的，刚通电,网卡广播发送　FFFFFFFF（路由器收到）.在路由器返回时已经学习到了ip@mac,根据已经学习到的ip@mac向发送的计算机发送路由器的ip@mac地址

**创建路由**(需要关闭192.168.150.13防火墙,解决关闭防火墙问题)

​		在A（192.168.150.13）创建一个网卡，在局域网B机器ping通

​		在Ａ创建网卡(可以拿虚拟机内网不在统一网段ip一样)：ifconfig eth0:3 192.168.88.88/24

​        在Ｂ创建路由：route add -host 192.168.88.88 gw 192.168.150.13

​	    现在就可以在B机器ping通Ａ机器192.168.88.88了
