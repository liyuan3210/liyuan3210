## linux体系了解

```
Linux内核 0.11：
Linux内核查看工具
https://zhuanlan.zhihu.com/p/523591912
https://github.com/KrisJiaqiXie/linux_kernel_study.git
```

#### 体系结构

```
用户程序
｜
标准库
-------------------------
系统调用(服务层)
文件系统VFS	进程管理（与进程通信）
内存管理		驱动管理
-------------------------
硬件
```

#### 中断体系

```
中断目的：
	1.硬件中断响应
	2.系统调用的函数响应
	3.自定义中断
	4.信号中断（kill -signalnum）
	5.系统的异常和错误
中断分类：硬件中断，软件中断
	硬件中断：硬件控制芯片发出的
	软中断：异常错误，系统调用异常

sys_call服务层接口：
Kernel与arch文件夹？？？
Kernel/asm.s		trap.c
Kernel/system.call.s	fork.c	signal.c exit.c sys.c
```

#### 内核初始化

```
CPU内部有一个RTC,开机计算1970年1月1日0时开始所过的秒数。
给MKTIME函数传过来的时间结构赋值是由初始化RTC或coms中读出的参数，转换为时间存在全局变量中，
为jiffies所调用。

jiffies时一个系统的时钟滴答 一个系统滴答是10ms,定时器
	每隔10ms产生一个定时器中断，调用do_timer

cpl表示当前被中断进程所存储的 0表示是内核进程，1是用户进程
current->counter: 进程调度的时间片,???
```

#### 进程创建,调度,切换

###### 进程创建

```
task_struct
	堆栈
	TSS进程描述符（进程运行的过程中，cpu需要知道的进程状态标识）
	LDT(局部描述符，代码段，数据段)

系统级别GDT描述符（进程调度初始化）
	。。。
	进程3
	进程2
	进程1
	内核数据段
	内核代码段

内核态	不可抢占
用户态	可以抢占

Main.c
Fork->init(),创建fork 0号进程,所有进程都是0号进程子进程
最后把内核态切换到用户态
```

###### 进程调度

```
void schedule(void) 进程调度（哪个进程先要执行）
	counter,时间片
	priority,优先级
    switch_to(next) 进程切换函数（切换进程）

进程状态：
	运行状态		可以被运行，就绪，进程切换
	可中断睡眠状态	可以被信号中断
	不可中断睡眠状态	只能被wakeup所唤醒
	暂停状态
	僵死状态
```

###### 进程销毁

```
系统调用一般都是syscall,do_xxx
1.内核销毁
	1.1exit是销毁函数
		首先会释放进程的代码段，数据段
	1.2.关闭进程打开的所有文件，对当前的目录i节点进行同步
	1.3.当前要销毁的进程有子进程，就让x进程作为新的父进程
	1.4.如果当前进程是一个会话头进程，则会终止会话中的所有进程
	1.5 改变当前进程的运行状态为僵死，并向其父进程发送SIGCHLD信号

	2.1 父进程运行子进程时候 ，一般都会运行wait waitpid这两个函数
	2.2 父进程会把子进程的运行时间累加到自己的进程变量中
	2.3 把对应子进程的进程描述结构体进行释放，置空任务数组中的空槽
```

#### 文件系统(vfs)

```
1.linux中使用文件系统几个部分
	1.1 关于linux中高速缓冲区的管理程序。分页机制，buffer.c
	1.2 文件系统的底层通用函数（对硬盘的读写，分配，释放，对于目录的节点管理inode,内存与磁盘的映射）
	1.3 对文件数据进行读写操作模块（VFS：虚拟文件系统，硬件驱动 和 文件系统的关系，pipe块设备等）
	1.4 文件系统与其他程序的接口实现（fopen 关闭 创建等使用文件的调用方式）

2.文件系统的基本概念
	磁盘中要有目录映射，我们把磁盘分成盘片
	每一个盘片都有一个文件系统的子系统

	数据结构：
	引导块：用来引导设备的，引导块可以为空
	超级块：是该文件子系统的描述符
	逻辑块位图：其每一位对应一个逻辑块的使用情况，对应逻辑块如果使用了则逻辑块对应位置为1
	i节点位图：其每一位对应一个i节点的使用情况，对应i节点如果使用了则对应i节点位图上位置为1
	逻辑块：用来存储数据的数据存储单元
	i节点：目录 与 磁盘的桥接 文件的属性描述

一个最小文件系统需要什么？
	1. /dev/console
	2.init_main函数---->busybox
	3./etc/init.d/rcS----->脚本
	4.因为需要运行shell命令，所以需要shell命令支持函数---->busybox
	5.busybox响应函数运行必须要标准库函数的支持----->glibc
```

#### 内存管理

