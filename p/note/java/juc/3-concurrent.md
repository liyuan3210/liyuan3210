# 三.生产消费容器demo,读源码规则

## 1.demo1

```
实现一个容器，提供两个方法，add，size
写两个线程，线程1添加10个元素到容器中
线程2实现监控元素个数，当个数到5个时，线程2提示并结束
```

## 2.demo2

```
写一个固定容量同步容器，有put，get，getCount方法，
能够支持2个生成线程，及10个消费者线程的阻塞调用
```

## 3.读源码原则

```
跑不起来不读
解决问题就好-目的性
一条线索到底
无关细节略过
一般不读静态
一般动态读法

要点：
1.数据结构基础
2.设计模式

AQS：
Template Method
Callback Function
父类默认实现，子类具体实现
```

3.1流程图

3.2VarHandle

```
普通属性原子操作，比反射快，直接操作二进制码
```

## 4.RefType And TheadLocal

java四种引用‘强软弱虚’

```
强引用：值为null后内存会进行回收（一般new出来的都是强引用）
软引用：产生gc内存不一定回收，产生新的对象不满足空间时才进行回收（验证程序需要配置堆内存大小20mb方便测试）
弱引用：只要gc就进行回收，作用（如果有个强引用指向，强引用消失，会跟随回收，一般用在容器，TheadLocal用到）
虚引用：堆内存外，DirectByteBuffer。虚引用get不到值.
通过队列获取垃圾回收通知（c,c++写的用对应语言回收），1.9后就没unsafe
```

## 



